// This is a +bbnew command for Myrddin's BBS. It reads the next unread board message.

&CMD_+BBNEW BBS - Myrddin's Global BBS v4.0.6=$+bbnew: @switch setq(0,first(iter(u(#16/valid_groups,%#,read),switch(trim(u(#16/unreadnums,%#,##)),,,none-unread,,##))))[words(%q0)]=0,{@pemit %#=No unread messages on any board.},{think setq(4,member(xget(#16,groups),%q0))[setq(5,first(u(#16/unreadnums,%#,%q0)))];@switch and(lte(%q5,words(setr(7,xget(%q0,MESS_LST)))),isnum(%q5))=0,{@pemit %#=No new messages beyond %q4[setr(6,add(after(%0,/),0))] ([name(%q0)]/%q6).},{@pemit %#=center(=%b[name(%q0)]%b=,78,=)%r[ljust(Message: %q4/%q5[switch(u(#16/fn_timeout_close, index(setr(3, xget(%q0,HDR_[extract(%q7,%q5,1)])),|,5,1)),1,%b\(timeout warning\))],35)]Posted[space(8)]Author%r[ljust(index(%q3,|,1,1),35)][ljust(index(%q3,|,2,1),14)][mid(index(%q3,|,3,1)[ifelse(and(hasattr(%q0,anonymous), orflags(%#,Wr)),%b\([name(index(%q3,|,4,1))]\),)],0,29)]%r[repeat(-,78)]%r[xget(%q0,BDY_[extract(%q7,%q5,1)])]%r[repeat(=,78)]; &bb_read %#=[setunion(xget(%#,bb_read),extract(%q7,%q5,1))]}}