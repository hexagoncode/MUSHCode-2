// This modifies Anomaly Jobs v6.5... I think

// +myjob/mail -- this allows PLAYERS to send out a mail when they add to their job, so other players will get a @mail.

&CMD_MYJOB/MAIL Job Global Object <JGO>==$+myjob/mail *=*:@switch [not(haspower(%#,guest))][setq(0,locate(%va,Job %0,i))][isdbref(%q0)][or(and(u(%va/IS_PUBLIC,%q0),match(get(%q0/opened_by),%#)), strmatch(parent(%q0), #286))][not(hasattr(%q0,LOCKED))]=0*,@pemit %#={This command is not available to guests.},10*, @pemit %#={That is an invalid job number.},110*,{@pemit %#=Job %0 is not yours. You can only modify your own jobs.},1110*,{@pemit %#=That job is locked and cannot be changed at this time.},{@pemit %#=You have mailed [u(%va/FN_PLAYERLIST,%q0)] about job #%0, with the comments: %1;@trigger %va/TRIG_ADD=%q0,[strtrunc(ansi(h,Player Mail sent to [u(%va/FN_PLAYERLIST,%q0)]:)%r%r%1,get(%va/BUFFER))],%#,MAI;&DUE_ON %q0=[add(secs(), mul(4, mul(24, mul(60, 60))))];@trigger %va/TRIG_BROADCAST=[parent(%q0)],Player Mail sent about job #%0 by %n.};{@wait .5=[set(%q0/[last(lattr(%q0/COMMENT_*))],no_inherit)];[pemit(remove(u(%q0/OPENED_BY),%#),Comments added to [name( %q0 )] by [name( %# )].)]}

// This modifies +myjob/add so that when a player adds, it auto-publishes that single entry, so other players can see it. This is great for when you don't want the WHOLE JOB published (ie, so players can't see what staffers are saying via /add), but other players can.

&CMD_MYJOB/ADD Job Global Object <JGO>=$+myjob/add *=*:@switch [not(u(%va/FN_GUEST,%#))][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][or(and(u(%va/IS_PUBLIC,%q0),match(get(%q0/OPENED_BY),%#)),u(%va/FN_MYACCESSCHECK,parent(%q0),%#,%q0),)][not(u(%va/FN_HASATTR,%q0,LOCKED))]=0*,@pemit %#=This command is not available to guests.,10*,@pemit %#=That is an invalid job number.,110*,@pemit %#=[name(%q0)] is not yours. You can only modify your own jobs.,1110*,@pemit %#=That job is locked and cannot be changed at this time.,{@pemit %#=Comments to [name(%q0)] added.;&STATUS %q0=2;@trigger %va/TRIG_ADD=%q0,trim(%1),%#,ADD;@trigger %va/TRIG_BROADCAST=%q0,%#,ADD};@wait .5=[set(%q0/[last(lattr(%q0/COMMENT_*))],no_inherit)];[pemit(remove(u(%q0/OPENED_BY),%#),Comments added to [name( %q0 )] by [name( %# )].)]}